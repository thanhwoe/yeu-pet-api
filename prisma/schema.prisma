generator client {
  provider     = "prisma-client"
  output       = "../src/generated/prisma"
  moduleFormat = "cjs"
}

datasource db {
  provider = "postgresql"
}

model accounts {
  id                      String            @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  email                   String?           @unique @db.VarChar(255)
  first_name              String?           @db.VarChar(255)
  last_name               String?           @db.VarChar(255)
  password_hash           String            @db.VarChar(255)
  phone                   String            @unique @db.VarChar(20)
  avatar_url              String?
  role                    user_role         @default(user)
  onboarding_completed    Boolean           @default(false)
  subscription            subscription_tier @default(free)
  subscription_expires_at DateTime?         @db.Timestamptz(6)
  is_active               Boolean?          @default(true)
  is_verified             Boolean?          @default(false)
  last_sign_in_at         DateTime?         @db.Timestamptz(6)
  created_at              DateTime?         @default(now()) @db.Timestamptz(6)
  updated_at              DateTime?         @default(now()) @db.Timestamptz(6)
  otp_tokens              otp_tokens?
  refresh_tokens          refresh_tokens[]

  @@index([email], map: "idx_accounts_email")
  @@index([phone], map: "idx_accounts_phone")
}

model refresh_tokens {
  id         String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  account_id String    @db.Uuid
  token_hash String    @unique
  expires_at DateTime  @db.Timestamptz(6)
  revoked_at DateTime? @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  accounts   accounts  @relation(fields: [account_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_refresh_tokens_account_id")

  @@index([token_hash], map: "idx_refresh_tokens_token_hash")
}

model otp_tokens {
  account_id String    @id @db.Uuid
  token      String?
  expires_at DateTime? @db.Timestamptz(6)
  created_at DateTime? @default(now()) @db.Timestamptz(6)
  updated_at DateTime? @default(now()) @db.Timestamptz(6)
  accounts   accounts  @relation(fields: [account_id], references: [id], onDelete: Cascade, onUpdate: NoAction, map: "fk_otp_tokens_account_id")

  @@index([account_id], map: "idx_otp_tokens_account_id")
}

enum subscription_tier {
  free
  premium
}

enum user_role {
  user
  admin
}
